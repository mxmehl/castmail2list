{% extends "base.html" %}

{% block title %}Settings - CastMail2List{% endblock %}

{% block content %}
<h2>Mailing Lists Settings</h2>

<div class="row">
    <div class="col-md-6">
        <h4>Add New List</h4>
        <form method="POST">
            {{ form.hidden_tag() }}

            <div class="mb-3">
                {{ form.name.label(class="form-label") }}
                {{ form.name(class="form-control") }}
                {% if form.name.errors %}
                    <div class="text-danger">
                        {% for error in form.name.errors %}
                            <small>{{ error }}</small>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div class="mb-3">
                {{ form.address.label(class="form-label") }}
                {{ form.address(class="form-control") }}
                {% if form.address.errors %}
                    <div class="text-danger">
                        {% for error in form.address.errors %}
                            <small>{{ error }}</small>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div class="mb-3">
                {{ form.imap_host.label(class="form-label") }}
                {{ form.imap_host(class="form-control", placeholder=config.IMAP_DEFAULT_HOST) }}
            </div>

            <div class="mb-3">
                {{ form.imap_port.label(class="form-label") }}
                {{ form.imap_port(class="form-control", placeholder=config.IMAP_DEFAULT_PORT) }}
            </div>

            <div class="mb-3">
                {{ form.imap_user.label(class="form-label") }}
                {{ form.imap_user(class="form-control") }}
            </div>

            <div class="mb-3">
                {{ form.imap_pass.label(class="form-label") }}
                {{ form.imap_pass(class="form-control") }}
            </div>

            <div class="mb-3">
                {{ form.from_addr.label(class="form-label") }}
                {{ form.from_addr(class="form-control") }}
            </div>

            {{ form.submit(class="btn btn-primary") }}
        </form>
    </div>

    <div class="col-md-6">
        <h4>Existing Lists</h4>
        {% if lists %}
            <div class="list-group">
                {% for list in lists %}
                    <div class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">{{ list.name }}</h6>
                            <div>
                                <a href="{{ url_for('edit_list', list_id=list.id) }}" class="btn btn-sm btn-outline-primary">Edit</a>
                                <a href="{{ url_for('manage_subs', list_id=list.id) }}" class="btn btn-sm btn-outline-secondary">Subscribers</a>
                            </div>
                        </div>
                        <p class="mb-1">{{ list.address }}</p>
                        <small>{{ list.subscribers|length }} subscribers</small>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="text-muted">No mailing lists configured yet.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
